<!DOCTYPE html>

<html>
<head>
  <title>qr.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>qr.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><a href="http://neocotic.com/qr.js">qr.js</a><br>(c) 2014 Alasdair Mercer<br>Freely distributable under the MIT license.<br>Based on <a href="http://code.google.com/p/jsqrencode/">jsqrencode</a><br>(c) 2010 tz@execpc.com<br>Licensed under the GPL Version 3 license.<br>For all details and documentation:<br><a href="http://neocotic.com/qr.js">http://neocotic.com/qr.js</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(root)</span> {</span>
<span class="hljs-pi">
  'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="private-constants">Private constants</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Alignment pattern.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ALIGNMENT_DELTA = [
    <span class="hljs-number">0</span>,  <span class="hljs-number">11</span>, <span class="hljs-number">15</span>, <span class="hljs-number">19</span>, <span class="hljs-number">23</span>, <span class="hljs-number">27</span>, <span class="hljs-number">31</span>,
    <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">20</span>, <span class="hljs-number">22</span>, <span class="hljs-number">24</span>, <span class="hljs-number">26</span>, <span class="hljs-number">28</span>, <span class="hljs-number">20</span>, <span class="hljs-number">22</span>, <span class="hljs-number">24</span>, <span class="hljs-number">24</span>, <span class="hljs-number">26</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">22</span>, <span class="hljs-number">24</span>, <span class="hljs-number">24</span>,
    <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">24</span>, <span class="hljs-number">24</span>, <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">24</span>, <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">26</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>
  ];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Default MIME type.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> DEFAULT_MIME = <span class="hljs-string">'image/png'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>MIME used to initiate a browser download prompt when <code>qr.save</code> is called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> DOWNLOAD_MIME = <span class="hljs-string">'image/octet-stream'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>There are four elements per version. The first two indicate the number of blocks, then the
data width, and finally the ECC width.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ECC_BLOCKS = [
    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">19</span>,  <span class="hljs-number">7</span>,     <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">10</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">13</span>,  <span class="hljs-number">13</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">9</span>,   <span class="hljs-number">17</span>,
    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">34</span>,  <span class="hljs-number">10</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">28</span>,  <span class="hljs-number">16</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">55</span>,  <span class="hljs-number">15</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">44</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">17</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">13</span>,  <span class="hljs-number">22</span>,
    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">80</span>,  <span class="hljs-number">20</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">32</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">9</span>,   <span class="hljs-number">16</span>,
    <span class="hljs-number">1</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">108</span>, <span class="hljs-number">26</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">43</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">15</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">11</span>,  <span class="hljs-number">22</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">68</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">27</span>,  <span class="hljs-number">16</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">19</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">15</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">78</span>,  <span class="hljs-number">20</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">31</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">14</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">13</span>,  <span class="hljs-number">26</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">97</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">38</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">18</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">14</span>,  <span class="hljs-number">26</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">116</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">3</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">36</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">20</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">12</span>,  <span class="hljs-number">24</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">68</span>,  <span class="hljs-number">18</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">43</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">6</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">19</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">6</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">15</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">81</span>,  <span class="hljs-number">20</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">50</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">3</span>,  <span class="hljs-number">8</span>,  <span class="hljs-number">12</span>,  <span class="hljs-number">24</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">92</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">6</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">36</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">20</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">7</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">14</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">4</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">107</span>, <span class="hljs-number">26</span>,    <span class="hljs-number">8</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">37</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">8</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">20</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">12</span>, <span class="hljs-number">4</span>,  <span class="hljs-number">11</span>,  <span class="hljs-number">22</span>,
    <span class="hljs-number">3</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">115</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">40</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">5</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">20</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">5</span>,  <span class="hljs-number">12</span>,  <span class="hljs-number">24</span>,
    <span class="hljs-number">5</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">87</span>,  <span class="hljs-number">22</span>,    <span class="hljs-number">5</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">41</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">5</span>,  <span class="hljs-number">7</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">7</span>,  <span class="hljs-number">12</span>,  <span class="hljs-number">24</span>,
    <span class="hljs-number">5</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">98</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">7</span>,  <span class="hljs-number">3</span>,  <span class="hljs-number">45</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">15</span>, <span class="hljs-number">2</span>,  <span class="hljs-number">19</span>,  <span class="hljs-number">24</span>,    <span class="hljs-number">3</span>,  <span class="hljs-number">13</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">1</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">107</span>, <span class="hljs-number">28</span>,    <span class="hljs-number">10</span>, <span class="hljs-number">1</span>,  <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">15</span>, <span class="hljs-number">22</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">17</span>, <span class="hljs-number">14</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">5</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">120</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">9</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">43</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">17</span>, <span class="hljs-number">1</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">19</span>, <span class="hljs-number">14</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">3</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">113</span>, <span class="hljs-number">28</span>,    <span class="hljs-number">3</span>,  <span class="hljs-number">11</span>, <span class="hljs-number">44</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">17</span>, <span class="hljs-number">4</span>,  <span class="hljs-number">21</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">9</span>,  <span class="hljs-number">16</span>, <span class="hljs-number">13</span>,  <span class="hljs-number">26</span>,
    <span class="hljs-number">3</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">107</span>, <span class="hljs-number">28</span>,    <span class="hljs-number">3</span>,  <span class="hljs-number">13</span>, <span class="hljs-number">41</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">15</span>, <span class="hljs-number">5</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">28</span>,
    <span class="hljs-number">4</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">116</span>, <span class="hljs-number">28</span>,    <span class="hljs-number">17</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">42</span>,  <span class="hljs-number">26</span>,    <span class="hljs-number">17</span>, <span class="hljs-number">6</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">19</span>, <span class="hljs-number">6</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">2</span>,  <span class="hljs-number">7</span>,  <span class="hljs-number">111</span>, <span class="hljs-number">28</span>,    <span class="hljs-number">17</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">7</span>,  <span class="hljs-number">16</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">34</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">13</span>,  <span class="hljs-number">24</span>,
    <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">121</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">14</span>, <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">14</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">16</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">6</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">117</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">6</span>,  <span class="hljs-number">14</span>, <span class="hljs-number">45</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">30</span>, <span class="hljs-number">2</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">8</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">106</span>, <span class="hljs-number">26</span>,    <span class="hljs-number">8</span>,  <span class="hljs-number">13</span>, <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">7</span>,  <span class="hljs-number">22</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">22</span>, <span class="hljs-number">13</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">10</span>, <span class="hljs-number">2</span>,  <span class="hljs-number">114</span>, <span class="hljs-number">28</span>,    <span class="hljs-number">19</span>, <span class="hljs-number">4</span>,  <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">28</span>, <span class="hljs-number">6</span>,  <span class="hljs-number">22</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">33</span>, <span class="hljs-number">4</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">8</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">122</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">22</span>, <span class="hljs-number">3</span>,  <span class="hljs-number">45</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">8</span>,  <span class="hljs-number">26</span>, <span class="hljs-number">23</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">12</span>, <span class="hljs-number">28</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">3</span>,  <span class="hljs-number">10</span>, <span class="hljs-number">117</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">3</span>,  <span class="hljs-number">23</span>, <span class="hljs-number">45</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">4</span>,  <span class="hljs-number">31</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">31</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">7</span>,  <span class="hljs-number">7</span>,  <span class="hljs-number">116</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">21</span>, <span class="hljs-number">7</span>,  <span class="hljs-number">45</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">1</span>,  <span class="hljs-number">37</span>, <span class="hljs-number">23</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">19</span>, <span class="hljs-number">26</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">5</span>,  <span class="hljs-number">10</span>, <span class="hljs-number">115</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">19</span>, <span class="hljs-number">10</span>, <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">15</span>, <span class="hljs-number">25</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">23</span>, <span class="hljs-number">25</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">13</span>, <span class="hljs-number">3</span>,  <span class="hljs-number">115</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">29</span>, <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">42</span>, <span class="hljs-number">1</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">23</span>, <span class="hljs-number">28</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">17</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">115</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">10</span>, <span class="hljs-number">23</span>, <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">10</span>, <span class="hljs-number">35</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">19</span>, <span class="hljs-number">35</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">17</span>, <span class="hljs-number">1</span>,  <span class="hljs-number">115</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">14</span>, <span class="hljs-number">21</span>, <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">29</span>, <span class="hljs-number">19</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">11</span>, <span class="hljs-number">46</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">13</span>, <span class="hljs-number">6</span>,  <span class="hljs-number">115</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">14</span>, <span class="hljs-number">23</span>, <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">44</span>, <span class="hljs-number">7</span>,  <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">59</span>, <span class="hljs-number">1</span>,  <span class="hljs-number">16</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">12</span>, <span class="hljs-number">7</span>,  <span class="hljs-number">121</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">12</span>, <span class="hljs-number">26</span>, <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">39</span>, <span class="hljs-number">14</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">22</span>, <span class="hljs-number">41</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">6</span>,  <span class="hljs-number">14</span>, <span class="hljs-number">121</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">6</span>,  <span class="hljs-number">34</span>, <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">46</span>, <span class="hljs-number">10</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">2</span>,  <span class="hljs-number">64</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">17</span>, <span class="hljs-number">4</span>,  <span class="hljs-number">122</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">29</span>, <span class="hljs-number">14</span>, <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">49</span>, <span class="hljs-number">10</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">24</span>, <span class="hljs-number">46</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">4</span>,  <span class="hljs-number">18</span>, <span class="hljs-number">122</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">13</span>, <span class="hljs-number">32</span>, <span class="hljs-number">46</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">48</span>, <span class="hljs-number">14</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">42</span>, <span class="hljs-number">32</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">20</span>, <span class="hljs-number">4</span>,  <span class="hljs-number">117</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">40</span>, <span class="hljs-number">7</span>,  <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">43</span>, <span class="hljs-number">22</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">10</span>, <span class="hljs-number">67</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>,
    <span class="hljs-number">19</span>, <span class="hljs-number">6</span>,  <span class="hljs-number">118</span>, <span class="hljs-number">30</span>,    <span class="hljs-number">18</span>, <span class="hljs-number">31</span>, <span class="hljs-number">47</span>,  <span class="hljs-number">28</span>,    <span class="hljs-number">34</span>, <span class="hljs-number">34</span>, <span class="hljs-number">24</span>,  <span class="hljs-number">30</span>,    <span class="hljs-number">20</span>, <span class="hljs-number">61</span>, <span class="hljs-number">15</span>,  <span class="hljs-number">30</span>
  ];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Map of human-readable ECC levels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ECC_LEVELS = {
    L: <span class="hljs-number">1</span>,
    M: <span class="hljs-number">2</span>,
    Q: <span class="hljs-number">3</span>,
    H: <span class="hljs-number">4</span>
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Final format bits with mask (level &lt;&lt; 3 | mask).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> FINAL_FORMAT = [
    <span class="hljs-number">0x77c4</span>, <span class="hljs-number">0x72f3</span>, <span class="hljs-number">0x7daa</span>, <span class="hljs-number">0x789d</span>, <span class="hljs-number">0x662f</span>, <span class="hljs-number">0x6318</span>, <span class="hljs-number">0x6c41</span>, <span class="hljs-number">0x6976</span>, <span class="hljs-comment">/* L */</span>
    <span class="hljs-number">0x5412</span>, <span class="hljs-number">0x5125</span>, <span class="hljs-number">0x5e7c</span>, <span class="hljs-number">0x5b4b</span>, <span class="hljs-number">0x45f9</span>, <span class="hljs-number">0x40ce</span>, <span class="hljs-number">0x4f97</span>, <span class="hljs-number">0x4aa0</span>, <span class="hljs-comment">/* M */</span>
    <span class="hljs-number">0x355f</span>, <span class="hljs-number">0x3068</span>, <span class="hljs-number">0x3f31</span>, <span class="hljs-number">0x3a06</span>, <span class="hljs-number">0x24b4</span>, <span class="hljs-number">0x2183</span>, <span class="hljs-number">0x2eda</span>, <span class="hljs-number">0x2bed</span>, <span class="hljs-comment">/* Q */</span>
    <span class="hljs-number">0x1689</span>, <span class="hljs-number">0x13be</span>, <span class="hljs-number">0x1ce7</span>, <span class="hljs-number">0x19d0</span>, <span class="hljs-number">0x0762</span>, <span class="hljs-number">0x0255</span>, <span class="hljs-number">0x0d0c</span>, <span class="hljs-number">0x083b</span>  <span class="hljs-comment">/* H */</span>
  ];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Galois field exponent table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> GALOIS_EXPONENT = [
    <span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xe8</span>, <span class="hljs-number">0xcd</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x26</span>,
    <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xea</span>, <span class="hljs-number">0xc9</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x0c</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xc0</span>,
    <span class="hljs-number">0x9d</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x4e</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x4a</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x6a</span>, <span class="hljs-number">0xd4</span>, <span class="hljs-number">0xb5</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xee</span>, <span class="hljs-number">0xc1</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x23</span>,
    <span class="hljs-number">0x46</span>, <span class="hljs-number">0x8c</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xba</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xd2</span>, <span class="hljs-number">0xb9</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0xa1</span>,
    <span class="hljs-number">0x5f</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xc2</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x2f</span>, <span class="hljs-number">0x5e</span>, <span class="hljs-number">0xbc</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xca</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x0f</span>, <span class="hljs-number">0x1e</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xf0</span>,
    <span class="hljs-number">0xfd</span>, <span class="hljs-number">0xe7</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xbb</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0xb1</span>, <span class="hljs-number">0x7f</span>, <span class="hljs-number">0xfe</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xdf</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0xb6</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xe2</span>,
    <span class="hljs-number">0xd9</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x0d</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0xbd</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xce</span>,
    <span class="hljs-number">0x81</span>, <span class="hljs-number">0x1f</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x7c</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xed</span>, <span class="hljs-number">0xc7</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x3b</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xec</span>, <span class="hljs-number">0xc5</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xcc</span>,
    <span class="hljs-number">0x85</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0x6d</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0xa9</span>, <span class="hljs-number">0x4f</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0x54</span>,
    <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x9a</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0xa4</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0xaa</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xe4</span>, <span class="hljs-number">0xd5</span>, <span class="hljs-number">0xb7</span>, <span class="hljs-number">0x73</span>,
    <span class="hljs-number">0xe6</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xc6</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7e</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xe5</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0xb3</span>, <span class="hljs-number">0x7b</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0xff</span>,
    <span class="hljs-number">0xe3</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0x4b</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xc4</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x6e</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0x41</span>,
    <span class="hljs-number">0x82</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xc8</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xe0</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0xa7</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0xa6</span>,
    <span class="hljs-number">0x51</span>, <span class="hljs-number">0xa2</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xb2</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xf2</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0xc3</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0x09</span>,
    <span class="hljs-number">0x12</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0xf3</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0xcb</span>, <span class="hljs-number">0x8b</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x16</span>,
    <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xb0</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0xfa</span>, <span class="hljs-number">0xe9</span>, <span class="hljs-number">0xcf</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x6c</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x8e</span>, <span class="hljs-number">0x00</span>
  ];</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Galois field log table.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> GALOIS_LOG = [
    <span class="hljs-number">0xff</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0xc6</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xdf</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0xee</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xc7</span>, <span class="hljs-number">0x4b</span>,
    <span class="hljs-number">0x04</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xe0</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0xc1</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xc8</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x71</span>,
    <span class="hljs-number">0x05</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x2f</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x0f</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x8e</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x45</span>,
    <span class="hljs-number">0x1d</span>, <span class="hljs-number">0xb5</span>, <span class="hljs-number">0xc2</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x6a</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xb9</span>, <span class="hljs-number">0xc9</span>, <span class="hljs-number">0x9a</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0xe4</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xa6</span>,
    <span class="hljs-number">0x06</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x8b</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xfd</span>, <span class="hljs-number">0xe2</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xb3</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x88</span>,
    <span class="hljs-number">0x36</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xce</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xdb</span>, <span class="hljs-number">0xbd</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0xd2</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x40</span>,
    <span class="hljs-number">0x1e</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xb6</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0xc3</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x7e</span>, <span class="hljs-number">0x6e</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xfa</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xba</span>, <span class="hljs-number">0x3d</span>,
    <span class="hljs-number">0xca</span>, <span class="hljs-number">0x5e</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0x4e</span>, <span class="hljs-number">0xd4</span>, <span class="hljs-number">0xe5</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xf3</span>, <span class="hljs-number">0xa7</span>, <span class="hljs-number">0x57</span>,
    <span class="hljs-number">0x07</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xc0</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x8c</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x0d</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x4a</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0xed</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0xc5</span>, <span class="hljs-number">0xfe</span>, <span class="hljs-number">0x18</span>,
    <span class="hljs-number">0xe3</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0x7c</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x2e</span>,
    <span class="hljs-number">0x37</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xbc</span>, <span class="hljs-number">0xcf</span>, <span class="hljs-number">0xcd</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xb2</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x61</span>,
    <span class="hljs-number">0xf2</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x6d</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0xa2</span>,
    <span class="hljs-number">0x1f</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0xb7</span>, <span class="hljs-number">0x7b</span>, <span class="hljs-number">0xa4</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xc4</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0xec</span>, <span class="hljs-number">0x7f</span>, <span class="hljs-number">0x0c</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0xf6</span>,
    <span class="hljs-number">0x6c</span>, <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3b</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0xaa</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xb1</span>, <span class="hljs-number">0xbb</span>, <span class="hljs-number">0xcc</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x5a</span>,
    <span class="hljs-number">0xcb</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0xb0</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0xa9</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0xd7</span>,
    <span class="hljs-number">0x4f</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xd5</span>, <span class="hljs-number">0xe9</span>, <span class="hljs-number">0xe6</span>, <span class="hljs-number">0xe7</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0xe8</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0xea</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xaf</span>
  ];</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><em>Badness</em> coefficients.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> N1 = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">var</span> N2 = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">var</span> N3 = <span class="hljs-number">40</span>;
  <span class="hljs-keyword">var</span> N4 = <span class="hljs-number">10</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Version pattern.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> VERSION_BLOCK = [ 
    <span class="hljs-number">0xc94</span>, <span class="hljs-number">0x5bc</span>, <span class="hljs-number">0xa99</span>, <span class="hljs-number">0x4d3</span>, <span class="hljs-number">0xbf6</span>, <span class="hljs-number">0x762</span>, <span class="hljs-number">0x847</span>, <span class="hljs-number">0x60d</span>, <span class="hljs-number">0x928</span>, <span class="hljs-number">0xb78</span>, <span class="hljs-number">0x45d</span>, <span class="hljs-number">0xa17</span>, <span class="hljs-number">0x532</span>,
    <span class="hljs-number">0x9a6</span>, <span class="hljs-number">0x683</span>, <span class="hljs-number">0x8c9</span>, <span class="hljs-number">0x7ec</span>, <span class="hljs-number">0xec4</span>, <span class="hljs-number">0x1e1</span>, <span class="hljs-number">0xfab</span>, <span class="hljs-number">0x08e</span>, <span class="hljs-number">0xc1a</span>, <span class="hljs-number">0x33f</span>, <span class="hljs-number">0xd75</span>, <span class="hljs-number">0x250</span>, <span class="hljs-number">0x9d5</span>,
    <span class="hljs-number">0x6f0</span>, <span class="hljs-number">0x8ba</span>, <span class="hljs-number">0x79f</span>, <span class="hljs-number">0xb0b</span>, <span class="hljs-number">0x42e</span>, <span class="hljs-number">0xa64</span>, <span class="hljs-number">0x541</span>, <span class="hljs-number">0xc69</span>
  ];</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Mode for node.js file system file writes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> WRITE_MODE = <span class="hljs-built_in">parseInt</span>(<span class="hljs-string">'0666'</span>, <span class="hljs-number">8</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2 id="private-variables">Private variables</h2>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Run lengths for badness.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> badBuffer = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Constructor for <code>canvas</code> elements in the node.js environment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> Canvas;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Data block.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> dataBlock;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>ECC data blocks and tables.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> eccBlock, neccBlock1, neccBlock2;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>ECC buffer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> eccBuffer = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>ECC level (defaults to <strong>L</strong>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> eccLevel = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Image buffer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> frameBuffer = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Fixed part of the image.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> frameMask = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>File system within the node.js environment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> fs;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Constructor for <code>img</code> elements in the node.js environment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> Image;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Indicates whether or not this script is running in node.js.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> inNode = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Generator polynomial.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> polynomial = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Save the previous value of the <code>qr</code> variable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> previousQr = root.qr;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Data input buffer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> stringBuffer = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Version for the data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> version;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Data width is based on <code>version</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> width;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2 id="private-functions">Private functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Create a new canvas  using <code>document.createElement</code> unless script is running in node.js, in
which case the <code>canvas</code> module is used.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createCanvas</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> inNode ? <span class="hljs-keyword">new</span> Canvas() : root.document.createElement(<span class="hljs-string">'canvas'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Create a new image using <code>document.createElement</code> unless script is running in node.js, in
which case the <code>canvas</code> module is used.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createImage</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> inNode ? <span class="hljs-keyword">new</span> Image() : root.document.createElement(<span class="hljs-string">'img'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Force the canvas image to be downloaded in the browser.<br>Optionally, a <code>callback</code> function can be specified which will be called upon completed. Since
this is not an asynchronous operation, this is merely convenient and helps simplify the
calling code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span><span class="hljs-params">(cvs, data, callback)</span> {</span>
    <span class="hljs-keyword">var</span> mime = data.mime || DEFAULT_MIME;

    root.location.href = cvs.toDataURL(mime).replace(mime, DOWNLOAD_MIME);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span>) callback();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Normalize the <code>data</code> that is provided to the main API.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeData</span><span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">'string'</span>) data = { value: data };
    <span class="hljs-keyword">return</span> data || {};
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Override the <code>qr</code> API methods that require HTML5 canvas support to throw a relevant error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">overrideAPI</span><span class="hljs-params">(qr)</span> {</span>
    <span class="hljs-keyword">var</span> methods = [ <span class="hljs-string">'canvas'</span>, <span class="hljs-string">'image'</span>, <span class="hljs-string">'save'</span>, <span class="hljs-string">'saveSync'</span>, <span class="hljs-string">'toDataURL'</span> ];
    <span class="hljs-keyword">var</span> i;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">overrideMethod</span><span class="hljs-params">(name)</span> {</span>
      qr[name] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(name + <span class="hljs-string">' requires HTML5 canvas element support'</span>);
      };
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; methods.length; i++) {
      overrideMethod(methods[i]);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Asynchronously write the data of the rendered canvas to a given file path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writeFile</span><span class="hljs-params">(cvs, data, callback)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data.path !== <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Invalid path type: '</span> + <span class="hljs-keyword">typeof</span> data.path));
    }

    <span class="hljs-keyword">var</span> fd, buff;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Write the buffer to the open file stream once both prerequisites are met.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writeBuffer</span><span class="hljs-params">()</span> {</span>
      fs.write(fd, buff, <span class="hljs-number">0</span>, buff.length, <span class="hljs-number">0</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error)</span> {</span>
        fs.close(fd);

        callback(error);
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Create a buffer of the canvas data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cvs.toBuffer(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error, _buff)</span> {</span>
      <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> callback(error);

      buff = _buff;
      <span class="hljs-keyword">if</span> (fd) {
        writeBuffer();
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Open a stream for the file to be written.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fs.open(data.path, <span class="hljs-string">'w'</span>, WRITE_MODE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error, _fd)</span> {</span>
      <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> callback(error);

      fd = _fd;
      <span class="hljs-keyword">if</span> (buff) {
        writeBuffer();
      }
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Write the data of the rendered canvas to a given file path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">writeFileSync</span><span class="hljs-params">(cvs, data)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data.path !== <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Invalid path type: '</span> + <span class="hljs-keyword">typeof</span> data.path);
    }

    <span class="hljs-keyword">var</span> buff = cvs.toBuffer();
    <span class="hljs-keyword">var</span> fd = fs.openSync(data.path, <span class="hljs-string">'w'</span>, WRITE_MODE);

    <span class="hljs-keyword">try</span> {
      fs.writeSync(fd, buff, <span class="hljs-number">0</span>, buff.length, <span class="hljs-number">0</span>);
    } <span class="hljs-keyword">finally</span> {
      fs.closeSync(fd);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Set bit to indicate cell in frame is immutable (symmetric around diagonal).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setMask</span><span class="hljs-params">(x, y)</span> {</span>
    <span class="hljs-keyword">var</span> bit;

    <span class="hljs-keyword">if</span> (x &gt; y) {
      bit = x;
      x   = y;
      y   = bit;
    }

    bit   = y;
    bit  *= y;
    bit  += y;
    bit &gt;&gt;= <span class="hljs-number">1</span>;
    bit  += x;

    frameMask[bit] = <span class="hljs-number">1</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Enter alignment pattern. Foreground colour to frame, background to mask. Frame will be merged
with mask later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addAlignment</span><span class="hljs-params">(x, y)</span> {</span>
    <span class="hljs-keyword">var</span> i;

    frameBuffer[x + width * y] = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">for</span> (i = -<span class="hljs-number">2</span>; i &lt; <span class="hljs-number">2</span>; i++) {
      frameBuffer[(x + i)     + width * (y - <span class="hljs-number">2</span>)]     = <span class="hljs-number">1</span>;
      frameBuffer[(x - <span class="hljs-number">2</span>)     + width * (y + i + <span class="hljs-number">1</span>)] = <span class="hljs-number">1</span>;
      frameBuffer[(x + <span class="hljs-number">2</span>)     + width * (y + i)]     = <span class="hljs-number">1</span>;
      frameBuffer[(x + i + <span class="hljs-number">1</span>) + width * (y + <span class="hljs-number">2</span>)]     = <span class="hljs-number">1</span>;
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {
      setMask(x - <span class="hljs-number">1</span>, y + i);
      setMask(x + <span class="hljs-number">1</span>, y - i);
      setMask(x - i, y - <span class="hljs-number">1</span>);
      setMask(x + i, y + <span class="hljs-number">1</span>);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Exponentiation mod N.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">modN</span><span class="hljs-params">(x)</span> {</span>
    <span class="hljs-keyword">while</span> (x &gt;= <span class="hljs-number">255</span>) {
      x -= <span class="hljs-number">255</span>;
      x  = (x &gt;&gt; <span class="hljs-number">8</span>) + (x &amp; <span class="hljs-number">255</span>);
    }

    <span class="hljs-keyword">return</span> x;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Calculate and append <code>ecc</code> data to the <code>data</code> block. If block is in the string buffer the
indices to buffers are used.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">appendData</span><span class="hljs-params">(data, dataLength, ecc, eccLength)</span> {</span>
    <span class="hljs-keyword">var</span> bit, i, j;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; eccLength; i++) {
      stringBuffer[ecc + i] = <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; dataLength; i++) {
      bit = GALOIS_LOG[stringBuffer[data + i] ^ stringBuffer[ecc]];

      <span class="hljs-keyword">if</span> (bit !== <span class="hljs-number">255</span>) {
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">1</span>; j &lt; eccLength; j++) {
          stringBuffer[ecc + j - <span class="hljs-number">1</span>] = stringBuffer[ecc + j] ^
              GALOIS_EXPONENT[modN(bit + polynomial[eccLength - j])];
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (j = ecc; j &lt; ecc + eccLength; j++) {
          stringBuffer[j] = stringBuffer[j + <span class="hljs-number">1</span>];
        }
      }

      stringBuffer[ecc + eccLength - <span class="hljs-number">1</span>] = bit === <span class="hljs-number">255</span> ? <span class="hljs-number">0</span> :
          GALOIS_EXPONENT[modN(bit + polynomial[<span class="hljs-number">0</span>])];
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Check mask since symmetricals use half.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isMasked</span><span class="hljs-params">(x, y)</span> {</span>
    <span class="hljs-keyword">var</span> bit;

    <span class="hljs-keyword">if</span> (x &gt; y) {
      bit = x;
      x   = y;
      y   = bit;
    }

    bit   = y;
    bit  += y * y;
    bit &gt;&gt;= <span class="hljs-number">1</span>;
    bit  += x;

    <span class="hljs-keyword">return</span> frameMask[bit] === <span class="hljs-number">1</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Apply the selected mask out of the 8 options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyMask</span><span class="hljs-params">(mask)</span> {</span>
    <span class="hljs-keyword">var</span> x, y, r3x, r3y;

    <span class="hljs-keyword">switch</span> (mask) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width; y++) {
          <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width; x++) {
            <span class="hljs-keyword">if</span> (!((x + y) &amp; <span class="hljs-number">1</span>) &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width; y++) {
          <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width; x++) {
            <span class="hljs-keyword">if</span> (!(y &amp; <span class="hljs-number">1</span>) &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width; y++) {
          <span class="hljs-keyword">for</span> (r3x = <span class="hljs-number">0</span>, x = <span class="hljs-number">0</span>; x &lt; width; x++, r3x++) {
            <span class="hljs-keyword">if</span> (r3x === <span class="hljs-number">3</span>) r3x = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!r3x &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        <span class="hljs-keyword">for</span> (r3y = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>; y &lt; width; y++, r3y++) {
          <span class="hljs-keyword">if</span> (r3y === <span class="hljs-number">3</span>) r3y = <span class="hljs-number">0</span>;

          <span class="hljs-keyword">for</span> (r3x = r3y, x = <span class="hljs-number">0</span>; x &lt; width; x++, r3x++) {
            <span class="hljs-keyword">if</span> (r3x === <span class="hljs-number">3</span>) r3x = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!r3x &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width; y++) {
          <span class="hljs-keyword">for</span> (r3x = <span class="hljs-number">0</span>, r3y = ((y &gt;&gt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">1</span>), x = <span class="hljs-number">0</span>; x &lt; width; x++, r3x++) {
            <span class="hljs-keyword">if</span> (r3x === <span class="hljs-number">3</span>) {
              r3x = <span class="hljs-number">0</span>;
              r3y = !r3y;
            }

            <span class="hljs-keyword">if</span> (!r3y &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
        <span class="hljs-keyword">for</span> (r3y = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>; y &lt; width; y++, r3y++) {
          <span class="hljs-keyword">if</span> (r3y === <span class="hljs-number">3</span>) r3y = <span class="hljs-number">0</span>;

          <span class="hljs-keyword">for</span> (r3x = <span class="hljs-number">0</span>, x = <span class="hljs-number">0</span>; x &lt; width; x++, r3x++) {
            <span class="hljs-keyword">if</span> (r3x === <span class="hljs-number">3</span>) r3x = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!((x &amp; y &amp; <span class="hljs-number">1</span>) + !(!r3x | !r3y)) &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
        <span class="hljs-keyword">for</span> (r3y = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>; y &lt; width; y++, r3y++) {
          <span class="hljs-keyword">if</span> (r3y === <span class="hljs-number">3</span>) r3y = <span class="hljs-number">0</span>;

          <span class="hljs-keyword">for</span> (r3x = <span class="hljs-number">0</span>, x = <span class="hljs-number">0</span>; x &lt; width; x++, r3x++) {
            <span class="hljs-keyword">if</span> (r3x === <span class="hljs-number">3</span>) r3x = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!(((x &amp; y &amp; <span class="hljs-number">1</span>) + (r3x &amp;&amp; (r3x === r3y))) &amp; <span class="hljs-number">1</span>) &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
        <span class="hljs-keyword">for</span> (r3y = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>; y &lt; width; y++, r3y++) {
          <span class="hljs-keyword">if</span> (r3y === <span class="hljs-number">3</span>) r3y = <span class="hljs-number">0</span>;

          <span class="hljs-keyword">for</span> (r3x = <span class="hljs-number">0</span>, x = <span class="hljs-number">0</span>; x &lt; width; x++, r3x++) {
            <span class="hljs-keyword">if</span> (r3x === <span class="hljs-number">3</span>) r3x = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!(((r3x &amp;&amp; (r3x === r3y)) + ((x + y) &amp; <span class="hljs-number">1</span>)) &amp; <span class="hljs-number">1</span>) &amp;&amp; !isMasked(x, y)) {
              frameBuffer[x + y * width] ^= <span class="hljs-number">1</span>;
            }
          }
        }

        <span class="hljs-keyword">break</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Using the table for the length of each run, calculate the amount of bad image. Long runs or
those that look like finders are called twice; once for X and Y.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBadRuns</span><span class="hljs-params">(length)</span> {</span>
    <span class="hljs-keyword">var</span> badRuns = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> i;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= length; i++) {
      <span class="hljs-keyword">if</span> (badBuffer[i] &gt;= <span class="hljs-number">5</span>) {
        badRuns += N1 + badBuffer[i] - <span class="hljs-number">5</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>FBFFFBF as in finder.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">3</span>; i &lt; length - <span class="hljs-number">1</span>; i += <span class="hljs-number">2</span>) {
      <span class="hljs-keyword">if</span> (badBuffer[i - <span class="hljs-number">2</span>] === badBuffer[i + <span class="hljs-number">2</span>] &amp;&amp;
          badBuffer[i + <span class="hljs-number">2</span>] === badBuffer[i - <span class="hljs-number">1</span>] &amp;&amp;
          badBuffer[i - <span class="hljs-number">1</span>] === badBuffer[i + <span class="hljs-number">1</span>] &amp;&amp;
          badBuffer[i - <span class="hljs-number">1</span>] * <span class="hljs-number">3</span> === badBuffer[i] &amp;&amp;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Background around the foreground pattern? Not part of the specs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          (badBuffer[i - <span class="hljs-number">3</span>] === <span class="hljs-number">0</span> || i + <span class="hljs-number">3</span> &gt; length ||
           badBuffer[i - <span class="hljs-number">3</span>] * <span class="hljs-number">3</span> &gt;= badBuffer[i] * <span class="hljs-number">4</span> ||
           badBuffer[i + <span class="hljs-number">3</span>] * <span class="hljs-number">3</span> &gt;= badBuffer[i] * <span class="hljs-number">4</span>)) {
        badRuns += N3;
      }
    }

    <span class="hljs-keyword">return</span> badRuns;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Calculate how bad the masked image is (e.g. blocks, imbalance, runs, or finders).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkBadness</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> b, b1, bad, big, bw, count, h, x, y;
    bad = bw = count = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Blocks of same colour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width - <span class="hljs-number">1</span>; y++) {
      <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width - <span class="hljs-number">1</span>; x++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>All foreground colour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((frameBuffer[x + width * y] &amp;&amp;
             frameBuffer[(x + <span class="hljs-number">1</span>) + width * y] &amp;&amp;
             frameBuffer[x + width * (y + <span class="hljs-number">1</span>)] &amp;&amp;
             frameBuffer[(x + <span class="hljs-number">1</span>) + width * (y + <span class="hljs-number">1</span>)]) ||</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>All background colour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            !(frameBuffer[x + width * y] ||
              frameBuffer[(x + <span class="hljs-number">1</span>) + width * y] ||
              frameBuffer[x + width * (y + <span class="hljs-number">1</span>)] ||
              frameBuffer[(x + <span class="hljs-number">1</span>) + width * (y + <span class="hljs-number">1</span>)])) {
          bad += N2;
        }
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>X runs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width; y++) {
      badBuffer[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;

      <span class="hljs-keyword">for</span> (h = b = x = <span class="hljs-number">0</span>; x &lt; width; x++) {
        <span class="hljs-keyword">if</span> ((b1 = frameBuffer[x + width * y]) === b) {
          badBuffer[h]++;
        } <span class="hljs-keyword">else</span> {
          badBuffer[++h] = <span class="hljs-number">1</span>;
        }

        b   = b1;
        bw += b ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
      }

      bad += getBadRuns(h);
    }

    <span class="hljs-keyword">if</span> (bw &lt; <span class="hljs-number">0</span>) bw = -bw;

    big   = bw;
    big  += big &lt;&lt; <span class="hljs-number">2</span>;
    big &lt;&lt;= <span class="hljs-number">1</span>;

    <span class="hljs-keyword">while</span> (big &gt; width * width) {
      big -= width * width;
      count++;
    }

    bad += count * N4;</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Y runs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width; x++) {
      badBuffer[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;

      <span class="hljs-keyword">for</span> (h = b = y = <span class="hljs-number">0</span>; y &lt; width; y++) {
        <span class="hljs-keyword">if</span> ((b1 = frameBuffer[x + width * y]) === b) {
          badBuffer[h]++;
        } <span class="hljs-keyword">else</span> {
          badBuffer[++h] = <span class="hljs-number">1</span>;
        }

        b = b1;
      }

      bad += getBadRuns(h);
    }

    <span class="hljs-keyword">return</span> bad;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Generate the encoded QR image for the string provided.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateFrame</span><span class="hljs-params">(str)</span> {</span>
    <span class="hljs-keyword">var</span> i, j, k, m, t, v, x, y;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Find the smallest version that fits the string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    t = str.length;

    version = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">do</span> {
      version++;

      k = (eccLevel - <span class="hljs-number">1</span>) * <span class="hljs-number">4</span> + (version - <span class="hljs-number">1</span>) * <span class="hljs-number">16</span>;

      neccBlock1 = ECC_BLOCKS[k++];
      neccBlock2 = ECC_BLOCKS[k++];
      dataBlock  = ECC_BLOCKS[k++];
      eccBlock   = ECC_BLOCKS[k];

      k = dataBlock * (neccBlock1 + neccBlock2) + neccBlock2 - <span class="hljs-number">3</span> + (version &lt;= <span class="hljs-number">9</span>);

      <span class="hljs-keyword">if</span> (t &lt;= k) <span class="hljs-keyword">break</span>;
    } <span class="hljs-keyword">while</span> (version &lt; <span class="hljs-number">40</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>FIXME: Ensure that it fits insted of being truncated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    width = <span class="hljs-number">17</span> + <span class="hljs-number">4</span> * version;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Allocate, clear and setup data structures.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    v = dataBlock + (dataBlock + eccBlock) * (neccBlock1 + neccBlock2) + neccBlock2;

    <span class="hljs-keyword">for</span> (t = <span class="hljs-number">0</span>; t &lt; v; t++) {
      eccBuffer[t] = <span class="hljs-number">0</span>;
    }

    stringBuffer = str.slice(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">for</span> (t = <span class="hljs-number">0</span>; t &lt; width * width; t++) {
      frameBuffer[t] = <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">for</span> (t = <span class="hljs-number">0</span>; t &lt; (width * (width + <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>; t++) {
      frameMask[t] = <span class="hljs-number">0</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Insert finders: Foreground colour to frame and background to mask.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (t = <span class="hljs-number">0</span>; t &lt; <span class="hljs-number">3</span>; t++) {
      k = y = <span class="hljs-number">0</span>;

      <span class="hljs-keyword">if</span> (t === <span class="hljs-number">1</span>) k = (width - <span class="hljs-number">7</span>);
      <span class="hljs-keyword">if</span> (t === <span class="hljs-number">2</span>) y = (width - <span class="hljs-number">7</span>);

      frameBuffer[(y + <span class="hljs-number">3</span>) + width * (k + <span class="hljs-number">3</span>)] = <span class="hljs-number">1</span>;

      <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">6</span>; x++) {
        frameBuffer[(y + x) + width * k] = <span class="hljs-number">1</span>;
        frameBuffer[y + width * (k + x + <span class="hljs-number">1</span>)] = <span class="hljs-number">1</span>;
        frameBuffer[(y + <span class="hljs-number">6</span>) + width * (k + x)] = <span class="hljs-number">1</span>;
        frameBuffer[(y + x + <span class="hljs-number">1</span>) + width * (k + <span class="hljs-number">6</span>)] = <span class="hljs-number">1</span>;
      }

      <span class="hljs-keyword">for</span> (x = <span class="hljs-number">1</span>; x &lt; <span class="hljs-number">5</span>; x++) {
        setMask(y + x, k + <span class="hljs-number">1</span>);
        setMask(y + <span class="hljs-number">1</span>, k + x + <span class="hljs-number">1</span>);
        setMask(y + <span class="hljs-number">5</span>, k + x);
        setMask(y + x + <span class="hljs-number">1</span>, k + <span class="hljs-number">5</span>);
      }

      <span class="hljs-keyword">for</span> (x = <span class="hljs-number">2</span>; x &lt; <span class="hljs-number">4</span>; x++) {
        frameBuffer[(y + x) + width * (k + <span class="hljs-number">2</span>)] = <span class="hljs-number">1</span>;
        frameBuffer[(y + <span class="hljs-number">2</span>) + width * (k + x + <span class="hljs-number">1</span>)] = <span class="hljs-number">1</span>;
        frameBuffer[(y + <span class="hljs-number">4</span>) + width * (k + x)] = <span class="hljs-number">1</span>;
        frameBuffer[(y + x + <span class="hljs-number">1</span>) + width * (k + <span class="hljs-number">4</span>)] = <span class="hljs-number">1</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Alignment blocks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (version &gt; <span class="hljs-number">1</span>) {
      t = ALIGNMENT_DELTA[version];
      y = width - <span class="hljs-number">7</span>;

      <span class="hljs-keyword">for</span> (;;) {
        x = width - <span class="hljs-number">7</span>;

        <span class="hljs-keyword">while</span> (x &gt; t - <span class="hljs-number">3</span>) {
          addAlignment(x, y);

          <span class="hljs-keyword">if</span> (x &lt; t) <span class="hljs-keyword">break</span>;

          x -= t;
        }

        <span class="hljs-keyword">if</span> (y &lt;= t + <span class="hljs-number">9</span>) <span class="hljs-keyword">break</span>;

        y -= t;

        addAlignment(<span class="hljs-number">6</span>, y);
        addAlignment(y, <span class="hljs-number">6</span>);
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Single foreground cell.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    frameBuffer[<span class="hljs-number">8</span> + width * (width - <span class="hljs-number">8</span>)] = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Timing gap (mask only).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-number">7</span>; y++) {
      setMask(<span class="hljs-number">7</span>, y);
      setMask(width - <span class="hljs-number">8</span>, y);
      setMask(<span class="hljs-number">7</span>, y + width - <span class="hljs-number">7</span>);
    }

    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">8</span>; x++) {
      setMask(x, <span class="hljs-number">7</span>);
      setMask(x + width - <span class="hljs-number">8</span>, <span class="hljs-number">7</span>);
      setMask(x, width - <span class="hljs-number">8</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Reserve mask, format area.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">9</span>; x++) {
      setMask(x, <span class="hljs-number">8</span>);
    }

    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">8</span>; x++) {
      setMask(x + width - <span class="hljs-number">8</span>, <span class="hljs-number">8</span>);
      setMask(<span class="hljs-number">8</span>, x);
    }

    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-number">7</span>; y++) {
      setMask(<span class="hljs-number">8</span>, y + width - <span class="hljs-number">7</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Timing row/column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width - <span class="hljs-number">14</span>; x++) {
      <span class="hljs-keyword">if</span> (x &amp; <span class="hljs-number">1</span>) {
        setMask(<span class="hljs-number">8</span> + x, <span class="hljs-number">6</span>);
        setMask(<span class="hljs-number">6</span>, <span class="hljs-number">8</span> + x);
      } <span class="hljs-keyword">else</span> {
        frameBuffer[(<span class="hljs-number">8</span> + x) + width * <span class="hljs-number">6</span>] = <span class="hljs-number">1</span>;
        frameBuffer[<span class="hljs-number">6</span> + width * (<span class="hljs-number">8</span> + x)] = <span class="hljs-number">1</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Version block.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (version &gt; <span class="hljs-number">6</span>) {
      t = VERSION_BLOCK[version - <span class="hljs-number">7</span>];
      k = <span class="hljs-number">17</span>;

      <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">6</span>; x++) {
        <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-number">3</span>; y++, k--) {
          <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> &amp; (k &gt; <span class="hljs-number">11</span> ? version &gt;&gt; (k - <span class="hljs-number">12</span>) : t &gt;&gt; k)) {
            frameBuffer[(<span class="hljs-number">5</span> - x) + width * (<span class="hljs-number">2</span> - y + width - <span class="hljs-number">11</span>)] = <span class="hljs-number">1</span>;
            frameBuffer[(<span class="hljs-number">2</span> - y + width - <span class="hljs-number">11</span>) + width * (<span class="hljs-number">5</span> - x)] = <span class="hljs-number">1</span>;
          } <span class="hljs-keyword">else</span> {
            setMask(<span class="hljs-number">5</span> - x, <span class="hljs-number">2</span> - y + width - <span class="hljs-number">11</span>);
            setMask(<span class="hljs-number">2</span> - y + width - <span class="hljs-number">11</span>, <span class="hljs-number">5</span> - x);
          }
        }
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Sync mask bits. Only set above for background cells, so now add the foreground.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; width; y++) {
      <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt;= y; x++) {
        <span class="hljs-keyword">if</span> (frameBuffer[x + width * y]) {
          setMask(x, y);
        }
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Convert string to bit stream. 8-bit data to QR-coded 8-bit data (numeric, alphanum, or kanji
not supported).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    v = stringBuffer.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>String to array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; v; i++) {
      eccBuffer[i] = stringBuffer.charCodeAt(i);
    }

    stringBuffer = eccBuffer.slice(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Calculate max string length.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    x = dataBlock * (neccBlock1 + neccBlock2) + neccBlock2;

    <span class="hljs-keyword">if</span> (v &gt;= x - <span class="hljs-number">2</span>) {
      v = x - <span class="hljs-number">2</span>;

      <span class="hljs-keyword">if</span> (version &gt; <span class="hljs-number">9</span>) v--;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Shift and re-pack to insert length prefix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    i = v;

    <span class="hljs-keyword">if</span> (version &gt; <span class="hljs-number">9</span>) {
      stringBuffer[i + <span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;
      stringBuffer[i + <span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;

      <span class="hljs-keyword">while</span> (i--) {
        t = stringBuffer[i];

        stringBuffer[i + <span class="hljs-number">3</span>] |= <span class="hljs-number">255</span> &amp; (t &lt;&lt; <span class="hljs-number">4</span>);
        stringBuffer[i + <span class="hljs-number">2</span>] = t &gt;&gt; <span class="hljs-number">4</span>;
      }

      stringBuffer[<span class="hljs-number">2</span>] |= <span class="hljs-number">255</span> &amp; (v &lt;&lt; <span class="hljs-number">4</span>);
      stringBuffer[<span class="hljs-number">1</span>] = v &gt;&gt; <span class="hljs-number">4</span>;
      stringBuffer[<span class="hljs-number">0</span>] = <span class="hljs-number">0x40</span> | (v &gt;&gt; <span class="hljs-number">12</span>);
    } <span class="hljs-keyword">else</span> {
      stringBuffer[i + <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
      stringBuffer[i + <span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;

      <span class="hljs-keyword">while</span> (i--) {
        t = stringBuffer[i];

        stringBuffer[i + <span class="hljs-number">2</span>] |= <span class="hljs-number">255</span> &amp; (t &lt;&lt; <span class="hljs-number">4</span>);
        stringBuffer[i + <span class="hljs-number">1</span>] = t &gt;&gt; <span class="hljs-number">4</span>;
      }

      stringBuffer[<span class="hljs-number">1</span>] |= <span class="hljs-number">255</span> &amp; (v &lt;&lt; <span class="hljs-number">4</span>);
      stringBuffer[<span class="hljs-number">0</span>] = <span class="hljs-number">0x40</span> | (v &gt;&gt; <span class="hljs-number">4</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Fill to end with pad pattern.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    i = v + <span class="hljs-number">3</span> - (version &lt; <span class="hljs-number">10</span>);

    <span class="hljs-keyword">while</span> (i &lt; x) {
      stringBuffer[i++] = <span class="hljs-number">0xec</span>;
      stringBuffer[i++] = <span class="hljs-number">0x11</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Calculate generator polynomial.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    polynomial[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; eccBlock; i++) {
      polynomial[i + <span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;

      <span class="hljs-keyword">for</span> (j = i; j &gt; <span class="hljs-number">0</span>; j--) {
        polynomial[j] = polynomial[j] ? polynomial[j - <span class="hljs-number">1</span>] ^
            GALOIS_EXPONENT[modN(GALOIS_LOG[polynomial[j]] + i)] : polynomial[j - <span class="hljs-number">1</span>];
      }

      polynomial[<span class="hljs-number">0</span>] = GALOIS_EXPONENT[modN(GALOIS_LOG[polynomial[<span class="hljs-number">0</span>]] + i)];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Use logs for generator polynomial to save calculation step.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt;= eccBlock; i++) {
      polynomial[i] = GALOIS_LOG[polynomial[i]];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Append ECC to data buffer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    k = x;
    y = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; neccBlock1; i++) {
      appendData(y, dataBlock, k, eccBlock);

      y += dataBlock;
      k += eccBlock;
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; neccBlock2; i++) {
      appendData(y, dataBlock + <span class="hljs-number">1</span>, k, eccBlock);

      y += dataBlock + <span class="hljs-number">1</span>;
      k += eccBlock;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Interleave blocks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    y = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; dataBlock; i++) {
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; neccBlock1; j++) {
        eccBuffer[y++] = stringBuffer[i + j * dataBlock];
      }

      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; neccBlock2; j++) {
        eccBuffer[y++] = stringBuffer[(neccBlock1 * dataBlock) + i + (j * (dataBlock + <span class="hljs-number">1</span>))];
      }
    }

    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; neccBlock2; j++) {
      eccBuffer[y++] = stringBuffer[(neccBlock1 * dataBlock) + i + (j * (dataBlock + <span class="hljs-number">1</span>))];
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; eccBlock; i++) {
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; neccBlock1 + neccBlock2; j++) {
        eccBuffer[y++] = stringBuffer[x + i + j * eccBlock];
      }
    }

    stringBuffer = eccBuffer;</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Pack bits into frame avoiding masked area.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    x = y = width - <span class="hljs-number">1</span>;
    k = v = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>inteleaved data and ECC codes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    m = (dataBlock + eccBlock) * (neccBlock1 + neccBlock2) + neccBlock2;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; m; i++) {
      t = stringBuffer[i];

      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++, t &lt;&lt;= <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0x80</span> &amp; t) {
          frameBuffer[x + width * y] = <span class="hljs-number">1</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Find next fill position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">if</span> (v) {
            x--;
          } <span class="hljs-keyword">else</span> {
            x++;

            <span class="hljs-keyword">if</span> (k) {
              <span class="hljs-keyword">if</span> (y !== <span class="hljs-number">0</span>) {
                y--;
              } <span class="hljs-keyword">else</span> {
                x -= <span class="hljs-number">2</span>;
                k  = !k;

                <span class="hljs-keyword">if</span> (x === <span class="hljs-number">6</span>) {
                  x--;
                  y = <span class="hljs-number">9</span>;
                }
              }
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">if</span> (y !== width - <span class="hljs-number">1</span>) {
                y++;
              } <span class="hljs-keyword">else</span> {
                x -= <span class="hljs-number">2</span>;
                k  = !k;

                <span class="hljs-keyword">if</span> (x === <span class="hljs-number">6</span>) {
                  x--;
                  y -= <span class="hljs-number">8</span>;
                }
              }
            }
          }

          v = !v;
        } <span class="hljs-keyword">while</span> (isMasked(x, y));
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Save pre-mask copy of frame.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stringBuffer = frameBuffer.slice(<span class="hljs-number">0</span>);

    t = <span class="hljs-number">0</span>;
    y = <span class="hljs-number">30000</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Using <code>for</code> instead of <code>while</code> since in original Arduino code if an early mask was <em>good
enough</em> it wouldnt try for a better one since they get more complex and take longer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">8</span>; k++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Returns foreground-background imbalance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      applyMask(k);

      x = checkBadness();</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Is current mask better than previous best?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (x &lt; y) {
        y = x;
        t = k;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Dont increment <code>i</code> to a void redoing mask.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (t === <span class="hljs-number">7</span>) <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Reset for next pass.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      frameBuffer = stringBuffer.slice(<span class="hljs-number">0</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Redo best mask as none were <em>good enough</em> (i.e. last wasnt <code>t</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (t !== k) {
      applyMask(t);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Add in final mask/ECC level bytes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    y = FINAL_FORMAT[t + ((eccLevel - <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">3</span>)];</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Low byte.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">8</span>; k++, y &gt;&gt;= <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (y &amp; <span class="hljs-number">1</span>) {
        frameBuffer[(width - <span class="hljs-number">1</span> - k) + width * <span class="hljs-number">8</span>] = <span class="hljs-number">1</span>;

        <span class="hljs-keyword">if</span> (k &lt; <span class="hljs-number">6</span>) {
          frameBuffer[<span class="hljs-number">8</span> + width * k] = <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
          frameBuffer[<span class="hljs-number">8</span> + width * (k + <span class="hljs-number">1</span>)] = <span class="hljs-number">1</span>;
        }
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>High byte.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">7</span>; k++, y &gt;&gt;= <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (y &amp; <span class="hljs-number">1</span>) {
        frameBuffer[<span class="hljs-number">8</span> + width * (width - <span class="hljs-number">7</span> + k)] = <span class="hljs-number">1</span>;

        <span class="hljs-keyword">if</span> (k) {
          frameBuffer[(<span class="hljs-number">6</span> - k) + width * <span class="hljs-number">8</span>] = <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
          frameBuffer[<span class="hljs-number">7</span> + width * <span class="hljs-number">8</span>] = <span class="hljs-number">1</span>;
        }
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Finally, return the image data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> frameBuffer;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <h2 id="qr-js-setup">qr.js setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Build the publicly exposed API.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> qr = {</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <h2 id="constants">Constants</h2>

            </div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Current version of <code>qr</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    VERSION: <span class="hljs-string">'1.1.2'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <h2 id="qr-functions">QR functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Generate the QR code using the data provided and render it on to a <code>&lt;canvas&gt;</code> element.<br>If no <code>&lt;canvas&gt;</code> element is specified in the argument provided a new one will be created and
used.<br>ECC (error correction capacity) determines how many intential errors are contained in the QR
code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    canvas: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
      data = normalizeData(data);</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Module size of the generated QR code (i.e. 1-10).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> size = data.size &gt;= <span class="hljs-number">1</span> &amp;&amp; data.size &lt;= <span class="hljs-number">10</span> ? data.size : <span class="hljs-number">4</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Actual size of the QR code symbol and is scaled to 25 pixels (e.g. 1 = 25px, 3 = 75px).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      size *= <span class="hljs-number">25</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p><code>&lt;canvas&gt;</code> element used to render the QR code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> cvs = data.canvas || createCanvas();</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Retreive the 2D context of the canvas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> c2d = cvs.getContext(<span class="hljs-string">'2d'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Ensure the canvas has the correct dimensions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      c2d.canvas.width  = size;
      c2d.canvas.height = size;</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Fill the canvas with the correct background colour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      c2d.fillStyle = data.background || <span class="hljs-string">'#fff'</span>;
      c2d.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size, size);</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Determine the ECC level to be applied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      eccLevel = ECC_LEVELS[(data.level &amp;&amp; data.level.toUpperCase()) || <span class="hljs-string">'L'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Generate the image frame for the given <code>value</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> frame = generateFrame(data.value || <span class="hljs-string">''</span>);

      c2d.lineWidth = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Determine the <em>pixel</em> size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> px = size;
      px /= width;
      px  = <span class="hljs-built_in">Math</span>.round(px - <span class="hljs-number">0.5</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Draw the QR code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      c2d.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size, size);
      c2d.fillStyle = data.background || <span class="hljs-string">'#fff'</span>;
      c2d.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, px * (width + <span class="hljs-number">8</span>), px * (width + <span class="hljs-number">8</span>));
      c2d.fillStyle = data.foreground || <span class="hljs-string">'#000'</span>;

      <span class="hljs-keyword">var</span> i, j;

      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; width; i++) {
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; width; j++) {
          <span class="hljs-keyword">if</span> (frame[j * width + i]) {
            c2d.fillRect(px * i, px * j, px, px);
          }
        }
      }

      <span class="hljs-keyword">return</span> cvs;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Generate the QR code using the data provided and render it on to a <code>&lt;img&gt;</code> element.<br>If no <code>&lt;img&gt;</code> element is specified in the argument provided a new one will be created and
used.<br>ECC (error correction capacity) determines how many intential errors are contained in the QR
code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    image: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
      data = normalizeData(data);</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p><code>&lt;canvas&gt;</code> element only which the QR code is rendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> cvs = <span class="hljs-keyword">this</span>.canvas(data);</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p><code>&lt;img&gt;</code> element used to display the QR code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> img = data.image || createImage();</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Apply the QR code to <code>img</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      img.src    = cvs.toDataURL(data.mime || DEFAULT_MIME);
      img.height = cvs.height;
      img.width  = cvs.width;

      <span class="hljs-keyword">return</span> img;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Generate the QR code using the data provided and render it on to a <code>&lt;canvas&gt;</code> element and
save it as an image file.<br>If no <code>&lt;canvas&gt;</code> element is specified in the argument provided a new one will be created and
used.<br>ECC (error correction capacity) determines how many intential errors are contained in the QR
code.<br>If called in a browser the <code>path</code> property/argument is ignored and will simply prompt the
user to choose a location and file name. However, if called within node.js the file will be
saved to specified path.<br>A <code>callback</code> function must be provided which will be called once the saving process has
started. If an error occurs it will be passed as the first argument to this function,
otherwise this argument will be <code>null</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    save: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, path, callback)</span> {</span>
      data = normalizeData(data);

      <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">typeof</span> path) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'function'</span>:
          callback = path;
          path = <span class="hljs-literal">null</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
          data.path = path;
          <span class="hljs-keyword">break</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Callback function is required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Invalid callback type: '</span> + <span class="hljs-keyword">typeof</span> callback);
      }

      <span class="hljs-keyword">var</span> completed = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p><code>&lt;canvas&gt;</code> element only which the QR code is rendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> cvs = <span class="hljs-keyword">this</span>.canvas(data);</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Simple function to try and ensure that the <code>callback</code> function is only called once.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span><span class="hljs-params">(error)</span> {</span>
        <span class="hljs-keyword">if</span> (!completed) {
          completed = <span class="hljs-literal">true</span>;

          callback(error);
        }
      }

      <span class="hljs-keyword">if</span> (inNode) {
        writeFile(cvs, data, done);
      } <span class="hljs-keyword">else</span> {
        download(cvs, data, done);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Generate the QR code using the data provided and render it on to a <code>&lt;canvas&gt;</code> element and
save it as an image file.<br>If no <code>&lt;canvas&gt;</code> element is specified in the argument provided a new one will be created and
used.<br>ECC (error correction capacity) determines how many intential errors are contained in the QR
code.<br>If called in a browser the <code>path</code> property/argument is ignored and will simply prompt the
user to choose a location and file name. However, if called within node.js the file will be
saved to specified path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    saveSync: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, path)</span> {</span>
      data = normalizeData(data);

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> path === <span class="hljs-string">'string'</span>) data.path = path;</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p><code>&lt;canvas&gt;</code> element only which the QR code is rendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> cvs = <span class="hljs-keyword">this</span>.canvas(data);

      <span class="hljs-keyword">if</span> (inNode) {
        writeFileSync(cvs, data);
      } <span class="hljs-keyword">else</span> {
        download(cvs, data);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Generate the QR code using the data provided and render it on to a <code>&lt;canvas&gt;</code> element before
returning its data URI.<br>If no <code>&lt;canvas&gt;</code> element is specified in the argument provided a new one will be created and
used.<br>ECC (error correction capacity) determines how many intential errors are contained in the QR
code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toDataURL: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
      data = normalizeData(data);

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.canvas(data).toDataURL(data.mime || DEFAULT_MIME);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <h2 id="utility-functions">Utility functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Run qr.js in <em>noConflict</em> mode, returning the <code>qr</code> variable to its previous owner.<br>Returns a reference to <code>qr</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    noConflict: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      root.qr = previousQr;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

  };</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <h2 id="support">Support</h2>

            </div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Export <code>qr</code> for node.js and CommonJS.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports !== <span class="hljs-string">'undefined'</span>) {
    inNode = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> module !== <span class="hljs-string">'undefined'</span> &amp;&amp; module.exports) {
      exports = module.exports = qr;
    }
    exports.qr = qr;</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Import required node.js modules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Canvas = <span class="hljs-built_in">require</span>(<span class="hljs-string">'canvas'</span>);
    Image = Canvas.Image;
    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {
    define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">return</span> qr;
    });
  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>In non-HTML5 browser so strip base functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!root.HTMLCanvasElement) {
      overrideAPI(qr);
    }

    root.qr = qr;
  }

})(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
